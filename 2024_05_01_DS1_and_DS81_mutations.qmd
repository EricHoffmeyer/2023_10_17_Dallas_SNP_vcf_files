---
title: "2024_05_01_DS1_and_DS81_mutations"
format: html
editor: source
---

Dallas is looking for unique mutations in the DS-1-CL and DS-81-CL samples.

# Libraries

```{r}
library(tidyverse)
library(maftools)
```

# Directories

```{r}
data.dir <- "2024_04_26_results/"

results.dir <- "2024_05_01_results/"

if(!exists(results.dir)){
  dir.create(results.dir)
}
```

# Import MAF object

```{r}
options(future.globals.maxSize = 14000 * 1024^2) 

ds.maf <- read.maf(maf = paste0(data.dir, "ds.maf"))
```

Subset the MAF objects into DS 1 and DS 81 cell line MAF objects

```{r}
ds1.cl.maf <- subsetMaf(maf = ds.maf,
                        tsb = "DS-1-CL")

ds76.cl.maf <- subsetMaf(maf = ds.maf,
                         tsb = "DS-76-CL")

ds81.cl.maf <- subsetMaf(maf = ds.maf,
                         tsb = "DS-81-CL")
```

Dallas gave me a list of commonly mutated genes in DS ALL samples, so we can start with that

```{r}
# Read in data
dallas.df <- read.csv(file = "data/common_mutated_genes.csv",
                      header = F,
                      col.names = "gene_symbol")
```

Now to find the muatations in the common genes for each sample.

```{r}
ds1.cl.common.df <- dallas.df |> 
  inner_join(ds1.cl.maf@data, by = c("gene_symbol" = "Hugo_Symbol")) |> 
  select(gene_symbol:Variant_Type, AAchange.refGene)

write.csv(ds1.cl.common.df, file = paste0(results.dir, "DS-1-CL"))
```

```{r}
ds81.cl.common.df <- dallas.df |> 
  inner_join(ds81.cl.maf@data, by = c("gene_symbol" = "Hugo_Symbol")) |> 
  select(gene_symbol:Variant_Type)
```

Dallas wants the ones that are unique to each sample, so we have to get rid of any shared variants. 

Let's see if there are any duplicate aaChange values

```{r}
unique.df <- rbind(ds1.cl.common.df, ds81.cl.common.df) |> 
  arrange("gene_symbol")

unique.df |> 
  group_by(aaChange.refGene) |> 
  summarize(count = n()) |> 
  arrange(desc(count))
```
There are a few, so let's make a subset and look at them to confirm they are the same variants.

```{r}
dup.df <- data.frame(aaChange = c("p.A492V", "p.D7G", "p.I66T", "p.T227M", "p.T244I", "p.T264I", "p.V138I"))

unique.df |> 
  filter(aaChange %in% dup.df$aaChange) |> 
  arrange(aaChange)
```
These look to be true duplications, so we can remove them. There are 7 duplicates for a total of 14 rows that we need to remove.

```{r}
anti_join(unique.df, dup.df, by = "aaChange")
```
Write the results

```{r}
write.csv(unique.df, paste0(results.dir, "ds1.and.ds81.variants.csv"))
```











# All CL samples together



```{r}
temp.maf <- subsetMaf(maf = ds.maf,
                        tsb = c("DS-1-CL", "DS-76-CL", "DS-81-CL"))

temp.maf.df <- temp.maf@data |> 
  select(Tumor_Sample_Barcode:Variant_Type)
```

```{r}
# Identify duplicates and make a single column datafame with them
dup.df <- temp.maf.df |> 
  group_by(aaChange) |> 
  summarize(count = n()) |> 
  filter(count > 1) |> 
  select(aaChange)

# anti_join with original dataframe to remove all duplicates
ds1.df <- anti_join(temp.maf.df, dup.df, by = "aaChange") |> 
  filter(Tumor_Sample_Barcode == "DS-1-CL")

ds81.df <- anti_join(temp.maf.df, dup.df, by = "aaChange") |> 
  filter(Tumor_Sample_Barcode == "DS-81-CL")

rm(ds1and81.df)
```






```{r}
sessionInfo()
```

